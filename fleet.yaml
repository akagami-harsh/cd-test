# Fleet bundle configuration
# This file tells Fleet how to deploy the contents of this repository
# Using pure Kustomize

defaultNamespace: gitops-test

# Target clusters with specific labels
targetCustomizations:
  - name: dev
    clusterSelector:
      matchLabels:
        env: dev
    kustomize:
      dir: overlays/dev

  - name: local
    clusterSelector:
      matchLabels:
        provider.cattle.io/name: local
    kustomize:
      dir: overlays/dev

# Default Kustomize options (fallback)
kustomize:
  dir: overlays/dev

# Deployment options - ignore labels that Fleet/Helm manages
diff:
  comparePatches:
    - apiVersion: apps/v1
      kind: Deployment
      operations:
        - {"op": "remove", "path": "/spec/replicas"}
        - {"op": "remove", "path": "/metadata/labels/app.kubernetes.io~1managed-by"}
    - apiVersion: v1
      kind: ConfigMap
      operations:
        - {"op": "remove", "path": "/metadata/labels/app.kubernetes.io~1managed-by"}
    - apiVersion: v1
      kind: Service
      operations:
        - {"op": "remove", "path": "/metadata/labels/app.kubernetes.io~1managed-by"}
